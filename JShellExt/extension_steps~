Does this some up everything?

write ruby logic in lib/rex/post/meterpreter/extensions
write ui in lib/rex/post/meterpreter/ui/console/command_dispatcher
drop extension in data/meterpreter
